<h1 id="_1">步骤</h1>
<h2 id="1ubuntuchrome-chromedriver">1.云服务器(ubuntu系统)安装chrome chromedriver</h2>
<div class="codehilite"><pre><span></span>sudo apt-get install libxss1 libappindicator1 libindicator7 <span class="o">(</span>apt-get error的话就apt-get update 或更新软件源<span class="o">)</span>

 google-chrome --version

 wget https://chromedriver.storage.googleapis.com/xxxxx/chromedriver_linux64.zip  xxxx和google-chrome大致版本一致
 <span class="o">(</span>https://chromedriver.chromium.org/downloads<span class="o">)</span>

 unzip chromedriver_linux64.zip -d /usr/bin

 chromedriver --version
</pre></div>

<h2 id="2seleniumapt-get-install-selenium">2.代码（没有selenium需要apt-get install selenium）</h2>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.chrome.options</span> <span class="kn">import</span> <span class="n">Options</span>  <span class="c1"># 无GUI</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="c1"># 设置全局变量</span>
<span class="n">stuIDs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;21&quot;</span><span class="p">]</span>

<span class="c1"># 如果检测到程序在 github actions 内运行，那么读取环境变量中的登录信息</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GITHUB_RUN_ID&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
    <span class="n">stuID</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;stuID&#39;</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">tianbiao</span><span class="p">():</span>
    <span class="n">chrome_options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">()</span>  <span class="c1"># 无界面对象</span>
    <span class="n">chrome_options</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--headless&#39;</span><span class="p">)</span>  <span class="c1"># 浏览器不提供可视化页面. linux下如果系统不支持可视化不加这条会启动失败</span>
    <span class="n">chrome_options</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;disable-dev-shm-usage&#39;</span><span class="p">)</span>  <span class="c1"># 禁用-开发-SHM-使用</span>
    <span class="n">chrome_options</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--disable-gpu&#39;</span><span class="p">)</span>  <span class="c1"># 谷歌文档提到需要加上这个属性来规避bug</span>
    <span class="n">chrome_options</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;no-sandbox&#39;</span><span class="p">)</span>  <span class="c1"># 解决DevToolsActivePort文件不存在的报错</span>
    <span class="n">chromedriver</span> <span class="o">=</span> <span class="s2">&quot;/usr/bin/chromedriver&quot;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;webdriver.chrome.driver&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">chromedriver</span>
    <span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="n">chrome_options</span><span class="p">,</span> <span class="n">executable_path</span><span class="o">=</span><span class="n">chromedriver</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">stuID</span> <span class="ow">in</span> <span class="n">stuIDs</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># 表单地址</span>
            <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://dw10.fdzcxy.edu.cn/datawarn/ReportServer?formlet=app/sjkrb.frm&amp;op=h5&amp;userno=&#39;</span> <span class="o">+</span> <span class="n">stuID</span> <span class="o">+</span> <span class="s1">&#39;#/form&#39;</span>
            <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>  <span class="c1"># 打开浏览器</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

            <span class="n">driver</span><span class="o">.</span><span class="n">maximize_window</span><span class="p">()</span>  <span class="c1"># 全屏</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

            <span class="c1"># 滚动到底部</span>
            <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;window.scrollTo(0, document.body.scrollHeight);&quot;</span><span class="p">)</span>

            <span class="c1"># 确认</span>
            <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s1">&#39;//input[@type=&quot;checkbox&quot;]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

            <span class="c1"># 点击提交</span>
            <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s1">&#39;//div[@id=&quot;SUBMIT&quot;]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">stuID</span> <span class="o">+</span> <span class="s2">&quot;打卡成功&quot;</span><span class="p">)</span>

        <span class="k">except</span><span class="p">:</span>
            <span class="n">FailLog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="s2">&quot;fail&quot;</span><span class="p">,</span><span class="n">sno</span><span class="o">=</span><span class="n">stuID</span><span class="p">,</span><span class="n">time</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">%H:%M:%S&#39;</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="n">stuID</span> <span class="o">+</span> <span class="s2">&quot;打卡失败&quot;</span><span class="p">)</span>
            <span class="n">dfs</span><span class="p">(</span><span class="n">stuID</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tianbiao</span><span class="p">()</span>
</pre></div>

<h2 id="3">3.设置定时执行 上段代码</h2>
<div class="codehilite"><pre><span></span><span class="c1"># 启动cron</span>
<span class="n">service</span> <span class="n">cron</span> <span class="n">start</span>
<span class="c1"># 编辑时间</span>
<span class="n">crontab</span> <span class="o">-</span><span class="n">e</span>
<span class="mi">5</span> <span class="mi">0</span> <span class="o">*</span> <span class="o">*</span> <span class="o">*</span>  <span class="n">python3</span> <span class="o">~/</span><span class="n">fillin</span><span class="o">.</span><span class="n">py</span>  <span class="c1"># 每天的0:05分执行</span>
</pre></div>